<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AppletTools â€“ Free Online Tools</title>
  <meta name="description" content="Free online tools for PDF, text, images and more. No signup required."/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>
  <!-- html2canvas: renders HTML to canvas for Wordâ†’PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- jsPDF: creates PDF from canvas pages -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- JSZip: builds .docx files (Open XML = ZIP of XML) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --blue:#2563EB; --blue-light:#EFF6FF; --blue-mid:#BFDBFE; --blue-dark:#1D4ED8;
      --navy:#0F172A; --slate:#475569; --muted:#94A3B8; --border:#E2E8F0;
      --bg:#F8FAFC; --white:#FFFFFF; --green:#10B981; --rose:#EF4444;
      --radius:12px;
      --shadow-hover:0 4px 8px rgba(37,99,235,.12),0 8px 32px rgba(37,99,235,.10);
    }
    body { font-family:'DM Sans',sans-serif; background:var(--bg); color:var(--navy); min-height:100vh; }
    nav { background:var(--white); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:100; display:flex; align-items:center; justify-content:space-between; padding:0 32px; height:60px; }
    .logo { display:flex; align-items:center; gap:10px; font-size:1.2rem; font-weight:700; color:var(--navy); cursor:pointer; }
    .logo-icon { width:32px; height:32px; background:var(--blue); border-radius:8px; display:flex; align-items:center; justify-content:center; }
    .logo-icon svg { width:18px; height:18px; stroke:white; fill:none; stroke-width:2; }
    .nav-links { display:flex; gap:4px; }
    .nav-links a { padding:6px 14px; border-radius:8px; font-size:.9rem; font-weight:500; color:var(--slate); cursor:pointer; transition:background .15s,color .15s; }
    .nav-links a:hover { background:var(--blue-light); color:var(--blue); }
    .hero { background:linear-gradient(135deg,#EFF6FF 0%,#DBEAFE 60%,#EFF6FF 100%); border-bottom:1px solid var(--blue-mid); padding:56px 32px 48px; text-align:center; }
    .hero-badge { display:inline-flex; align-items:center; background:var(--blue); color:white; font-size:.75rem; font-weight:600; letter-spacing:.06em; text-transform:uppercase; padding:4px 12px; border-radius:20px; margin-bottom:20px; }
    .hero h1 { font-size:clamp(2rem,4vw,3rem); font-weight:700; line-height:1.15; margin-bottom:14px; }
    .hero h1 span { color:var(--blue); }
    .hero p { font-size:1.1rem; color:var(--slate); max-width:500px; margin:0 auto 28px; }
    .search-bar { display:flex; max-width:480px; margin:0 auto; background:white; border:2px solid var(--blue-mid); border-radius:12px; overflow:hidden; box-shadow:0 4px 24px rgba(37,99,235,.12); transition:border-color .2s; }
    .search-bar:focus-within { border-color:var(--blue); }
    .search-bar input { flex:1; border:none; outline:none; padding:12px 16px; font-family:inherit; font-size:.95rem; color:var(--navy); }
    .search-bar button { background:var(--blue); color:white; border:none; padding:0 20px; cursor:pointer; font-weight:600; font-family:inherit; }
    .search-bar button:hover { background:var(--blue-dark); }
    main { max-width:1200px; margin:0 auto; padding:40px 24px 80px; }
    .category-tabs { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:32px; }
    .tab { padding:7px 16px; border-radius:8px; border:1.5px solid var(--border); background:white; font-size:.875rem; font-weight:500; color:var(--slate); cursor:pointer; transition:all .15s; }
    .tab:hover { border-color:var(--blue); color:var(--blue); background:var(--blue-light); }
    .tab.active { background:var(--blue); color:white; border-color:var(--blue); }
    .tool-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:16px; }
    .tool-card { background:white; border:1.5px solid var(--border); border-radius:var(--radius); padding:22px 20px; cursor:pointer; text-decoration:none; color:inherit; transition:border-color .2s,box-shadow .2s,transform .15s; display:flex; flex-direction:column; gap:12px; animation:fadeUp .4s ease both; }
    .tool-card:hover { border-color:var(--blue); box-shadow:var(--shadow-hover); transform:translateY(-2px); }
    @keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
    .tool-icon { width:44px; height:44px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1.4rem; }
    .tool-card h3 { font-size:.95rem; font-weight:600; }
    .tool-card p  { font-size:.82rem; color:var(--muted); line-height:1.5; flex:1; }
    .tool-tag { display:inline-block; font-size:.7rem; font-weight:600; padding:2px 8px; border-radius:4px; align-self:flex-start; text-transform:uppercase; letter-spacing:.04em; }
    #tool-page { display:none; position:fixed; inset:0; z-index:200; background:rgba(15,23,42,.5); backdrop-filter:blur(4px); align-items:center; justify-content:center; padding:16px; }
    #tool-page.open { display:flex; }
    .tool-panel { background:white; border-radius:16px; width:100%; max-width:820px; max-height:92vh; overflow-y:auto; box-shadow:0 24px 80px rgba(0,0,0,.2); animation:slideUp .25s ease; }
    @keyframes slideUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
    .panel-header { display:flex; align-items:center; justify-content:space-between; padding:20px 24px; border-bottom:1px solid var(--border); position:sticky; top:0; background:white; border-radius:16px 16px 0 0; z-index:1; }
    .panel-title { display:flex; align-items:center; gap:12px; }
    .panel-title h2 { font-size:1.15rem; font-weight:700; }
    .panel-close { width:32px; height:32px; border-radius:8px; border:1.5px solid var(--border); background:white; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.1rem; transition:all .15s; }
    .panel-close:hover { background:#FEF2F2; border-color:var(--rose); color:var(--rose); }
    .panel-body { padding:24px; }
    .tool-textarea { width:100%; border:1.5px solid var(--border); border-radius:10px; padding:14px; font-family:'DM Mono',monospace; font-size:.875rem; resize:vertical; outline:none; color:var(--navy); line-height:1.6; transition:border-color .2s; }
    .tool-textarea:focus { border-color:var(--blue); }
    .tool-input { width:100%; border:1.5px solid var(--border); border-radius:10px; padding:11px 14px; font-family:inherit; font-size:.9rem; outline:none; color:var(--navy); transition:border-color .2s; background:white; }
    .tool-input:focus { border-color:var(--blue); }
    .tool-select { border:1.5px solid var(--border); border-radius:10px; padding:10px 14px; font-family:inherit; font-size:.9rem; outline:none; color:var(--navy); background:white; cursor:pointer; width:100%; transition:border-color .2s; }
    .tool-select:focus { border-color:var(--blue); }
    .btn { padding:10px 20px; border-radius:9px; border:none; font-family:inherit; font-size:.9rem; font-weight:600; cursor:pointer; transition:all .15s; display:inline-flex; align-items:center; gap:6px; }
    .btn-primary { background:var(--blue); color:white; }
    .btn-primary:hover { background:var(--blue-dark); }
    .btn-primary:disabled { background:var(--muted); cursor:not-allowed; }
    .btn-outline { background:white; color:var(--slate); border:1.5px solid var(--border); }
    .btn-outline:hover { border-color:var(--blue); color:var(--blue); }
    .btn-danger  { background:#FEF2F2; color:var(--rose); border:1.5px solid #FECACA; }
    .btn-danger:hover  { background:var(--rose); color:white; }
    .btn-success { background:#ECFDF5; color:var(--green); border:1.5px solid #A7F3D0; }
    .btn-success:hover { background:var(--green); color:white; }
    .btn-row { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .field { margin-bottom:16px; }
    .field-label { display:block; font-size:.8rem; font-weight:600; color:var(--slate); margin-bottom:6px; text-transform:uppercase; letter-spacing:.04em; }
    .result-box { background:var(--bg); border:1.5px solid var(--border); border-radius:10px; padding:16px; margin-top:16px; font-family:'DM Mono',monospace; font-size:.875rem; color:var(--navy); line-height:1.7; white-space:pre-wrap; word-break:break-all; min-height:48px; }
    .stat-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:12px; margin-top:16px; }
    .stat-card { background:var(--blue-light); border-radius:10px; padding:14px; text-align:center; }
    .stat-card .num { font-size:1.6rem; font-weight:700; color:var(--blue); }
    .stat-card .lbl { font-size:.75rem; color:var(--slate); font-weight:500; margin-top:2px; }
    .drop-zone { border:2px dashed var(--blue-mid); border-radius:12px; padding:40px 24px; text-align:center; cursor:pointer; transition:border-color .2s,background .2s; color:var(--slate); }
    .drop-zone:hover { border-color:var(--blue); background:var(--blue-light); }
    .drop-zone .drop-icon { font-size:2.5rem; margin-bottom:10px; }
    .drop-zone p { font-size:.9rem; }
    .drop-zone span { color:var(--blue); font-weight:600; }
    input[type=file].hidden { display:none; }
    .info-row { display:flex; align-items:flex-start; gap:8px; background:var(--blue-light); border-radius:8px; padding:10px 14px; font-size:.85rem; color:var(--blue); margin-bottom:14px; font-weight:500; line-height:1.5; }
    .two-col { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    @media(max-width:580px){.two-col{grid-template-columns:1fr}}
    .file-item { display:flex; align-items:center; gap:8px; padding:8px 12px; background:var(--bg); border:1px solid var(--border); border-radius:8px; margin-bottom:6px; font-size:.875rem; }
    .file-item .fname { flex:1; font-weight:500; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .file-item .fsize { color:var(--muted); font-size:.8rem; flex-shrink:0; }
    .success-banner { background:#ECFDF5; border:1.5px solid #A7F3D0; color:#065F46; border-radius:10px; padding:14px 16px; margin-top:12px; font-weight:500; font-size:.9rem; }
    .error-banner   { background:#FEF2F2; border:1.5px solid #FECACA; color:#991B1B; border-radius:10px; padding:14px 16px; margin-top:12px; font-weight:500; font-size:.9rem; }
    .color-formats { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px; }
    .color-format { background:var(--bg); border:1.5px solid var(--border); border-radius:8px; padding:10px 12px; }
    .color-format .fmt-label { font-size:.7rem; font-weight:700; color:var(--muted); text-transform:uppercase; }
    .color-format .fmt-value { font-family:'DM Mono',monospace; font-size:.9rem; font-weight:500; display:flex; align-items:center; justify-content:space-between; }
    .copy-btn { background:none; border:none; cursor:pointer; color:var(--muted); font-size:.75rem; font-weight:600; padding:2px 6px; transition:color .15s; }
    .copy-btn:hover { color:var(--blue); }
    .spinner { display:inline-block; width:14px; height:14px; border:2px solid rgba(255,255,255,.4); border-top-color:white; border-radius:50%; animation:spin .7s linear infinite; }
    .spinner-blue { border-color:var(--blue-mid); border-top-color:var(--blue); }
    @keyframes spin{to{transform:rotate(360deg)}}
    #toast { position:fixed; bottom:24px; right:24px; z-index:999; background:var(--navy); color:white; padding:12px 20px; border-radius:10px; font-size:.875rem; font-weight:500; box-shadow:0 8px 32px rgba(0,0,0,.2); pointer-events:none; animation:toastIn .2s ease; }
    @keyframes toastIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
    footer { background:var(--navy); color:var(--muted); text-align:center; padding:28px 24px; font-size:.85rem; margin-top:40px; }
    footer a { color:var(--blue-mid); text-decoration:none; }
    footer a:hover { color:white; }
    .footer-links { display:flex; justify-content:center; gap:20px; margin-bottom:10px; }
    .preview-box { border:1.5px solid var(--border); border-radius:10px; padding:20px 24px; background:white; max-height:320px; overflow-y:auto; font-size:.9rem; line-height:1.8; color:var(--navy); }
    .preview-box-mono { font-family:'DM Mono',monospace; font-size:.8rem; line-height:1.7; white-space:pre-wrap; word-break:break-word; }
  </style>
</head>
<body>

<nav>
  <div class="logo" onclick="showHome()">
    <div class="logo-icon">
      <svg viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
    </div>
    AppletTools
  </div>
  <div class="nav-links">
    <a onclick="filterCategory('pdf',null)">ğŸ“„ PDF</a>
    <a onclick="filterCategory('text',null)">ğŸ“ Text</a>
    <a onclick="filterCategory('converter',null)">ğŸ”„ Converters</a>
    <a onclick="filterCategory('utility',null)">ğŸ› ï¸ Utilities</a>
  </div>
</nav>

<section class="hero">
  <div class="hero-badge">âš¡ 100% Free Â· No Signup Â· Runs in Browser</div>
  <h1>Everyday tools,<br><span>always free.</span></h1>
  <p>PDF, text, converters and utilities â€” everything runs directly in your browser. No files are uploaded.</p>
  <div class="search-bar">
    <input type="text" id="search-input" placeholder="Search toolsâ€¦ e.g. PDF merge, base64" oninput="searchTools(this.value)"/>
    <button>Search</button>
  </div>
</section>

<main>
  <div class="category-tabs">
    <button class="tab active" onclick="filterCategory('all',this)">All Tools</button>
    <button class="tab" onclick="filterCategory('pdf',this)">ğŸ“„ PDF</button>
    <button class="tab" onclick="filterCategory('text',this)">ğŸ“ Text</button>
    <button class="tab" onclick="filterCategory('converter',this)">ğŸ”„ Converters</button>
    <button class="tab" onclick="filterCategory('utility',this)">ğŸ› ï¸ Utilities</button>
  </div>
  <div id="tool-grid" class="tool-grid"></div>
</main>

<div id="tool-page">
  <div class="tool-panel">
    <div class="panel-header">
      <div class="panel-title">
        <span id="panel-icon" style="font-size:1.5rem"></span>
        <h2 id="panel-name"></h2>
      </div>
      <button class="panel-close" onclick="closeTool()">âœ•</button>
    </div>
    <div class="panel-body" id="panel-body"></div>
  </div>
</div>

<div id="toast" style="display:none"></div>

<footer>
  <div class="footer-links">
    <a href="#">About</a><a href="#">Privacy</a><a href="#">Terms</a><a href="#">Contact</a>
  </div>
  <div>Â© 2025 AppletTools â€” All processing happens in your browser. Your files never leave your device.</div>
</footer>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIGURE PDF.js worker
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
if (typeof pdfjsLib !== 'undefined') {
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOL REGISTRY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TOOLS = [
  // PDF
  {id:'pdf-merge',    cat:'pdf',       icon:'ğŸ“',color:'#FEF3C7',tag:'PDF',      tc:'#92400E',tb:'#FEF3C7',name:'Merge PDFs',            desc:'Combine multiple PDF files into one document.'},
  {id:'pdf-split',    cat:'pdf',       icon:'âœ‚ï¸',color:'#FEE2E2',tag:'PDF',      tc:'#991B1B',tb:'#FEE2E2',name:'Split / Extract Pages',  desc:'Extract specific page ranges from a PDF.'},
  {id:'pdf-info',     cat:'pdf',       icon:'ğŸ“‹',color:'#DBEAFE',tag:'PDF',      tc:'#1E40AF',tb:'#DBEAFE',name:'PDF Info',               desc:'View page count, dimensions and file size instantly.'},
  {id:'img-to-pdf',   cat:'pdf',       icon:'ğŸ–¼ï¸',color:'#F3E8FF',tag:'PDF',      tc:'#6B21A8',tb:'#F3E8FF',name:'Image to PDF',           desc:'Convert JPG/PNG images into a downloadable PDF.'},
  {id:'word-to-pdf',  cat:'pdf',       icon:'ğŸ“',color:'#DCFCE7',tag:'PDF',      tc:'#166534',tb:'#DCFCE7',name:'Word to PDF',            desc:'Convert a .docx Word file into a PDF download.'},
  {id:'pdf-to-word',  cat:'pdf',       icon:'ğŸ“„',color:'#FEF9C3',tag:'PDF',      tc:'#854D0E',tb:'#FEF9C3',name:'PDF to Word',            desc:'Extract text from a PDF and download as .docx.'},
  // Text
  {id:'word-counter', cat:'text',      icon:'ğŸ“Š',color:'#DCFCE7',tag:'Text',     tc:'#166534',tb:'#DCFCE7',name:'Word Counter',           desc:'Count words, characters, sentences & paragraphs.'},
  {id:'case-convert', cat:'text',      icon:'ğŸ”¡',color:'#EFF6FF',tag:'Text',     tc:'#1E40AF',tb:'#EFF6FF',name:'Case Converter',         desc:'Convert text to UPPER, lower, Title or camelCase.'},
  {id:'lorem-gen',    cat:'text',      icon:'ğŸ“„',color:'#FEF9C3',tag:'Text',     tc:'#854D0E',tb:'#FEF9C3',name:'Lorem Ipsum Generator',  desc:'Generate placeholder lorem ipsum text.'},
  {id:'text-diff',    cat:'text',      icon:'ğŸ”',color:'#FEE2E2',tag:'Text',     tc:'#991B1B',tb:'#FEE2E2',name:'Text Diff Checker',      desc:'Compare two texts and highlight differences.'},
  {id:'remove-lines', cat:'text',      icon:'ğŸ§¹',color:'#DCFCE7',tag:'Text',     tc:'#166534',tb:'#DCFCE7',name:'Remove Duplicate Lines', desc:'Remove duplicate or empty lines from text.'},
  // Converters
  {id:'base64',       cat:'converter', icon:'ğŸ”',color:'#F0FDF4',tag:'Converter',tc:'#166534',tb:'#F0FDF4',name:'Base64 Encode/Decode',   desc:'Encode or decode Base64 strings instantly.'},
  {id:'url-encode',   cat:'converter', icon:'ğŸ”—',color:'#FEF3C7',tag:'Converter',tc:'#92400E',tb:'#FEF3C7',name:'URL Encode/Decode',      desc:'Encode or decode URL / percent-encoded strings.'},
  {id:'json-fmt',     cat:'converter', icon:'ğŸ“‹',color:'#DBEAFE',tag:'Converter',tc:'#1E40AF',tb:'#DBEAFE',name:'JSON Formatter',         desc:'Format, validate and prettify JSON data.'},
  {id:'csv-to-json',  cat:'converter', icon:'ğŸ“Š',color:'#F3E8FF',tag:'Converter',tc:'#6B21A8',tb:'#F3E8FF',name:'CSV â†’ JSON',             desc:'Convert CSV data into clean JSON format.'},
  // Utilities
  {id:'color-picker', cat:'utility',   icon:'ğŸ¨',color:'#FDF4FF',tag:'Utility',  tc:'#7E22CE',tb:'#FDF4FF',name:'Color Picker',           desc:'Pick a color and get HEX, RGB, HSL values.'},
  {id:'password-gen', cat:'utility',   icon:'ğŸ”‘',color:'#FEF9C3',tag:'Utility',  tc:'#854D0E',tb:'#FEF9C3',name:'Password Generator',     desc:'Generate strong, random passwords instantly.'},
  {id:'char-counter', cat:'utility',   icon:'ğŸ”¢',color:'#ECFDF5',tag:'Utility',  tc:'#065F46',tb:'#ECFDF5',name:'Character Counter',      desc:'Count characters, letters, digits and more.'},
  {id:'uuid-gen',     cat:'utility',   icon:'ğŸ†”',color:'#EFF6FF',tag:'Utility',  tc:'#1E40AF',tb:'#EFF6FF',name:'UUID Generator',         desc:'Generate random UUID v4 strings.'},
  {id:'unix-time',    cat:'utility',   icon:'ğŸ•',color:'#FEE2E2',tag:'Utility',  tc:'#991B1B',tb:'#FEE2E2',name:'Unix Timestamp',         desc:'Convert between Unix timestamps and dates.'},
  {id:'img-compress', cat:'utility',   icon:'ğŸ—œï¸',color:'#FDF4FF',tag:'Utility',  tc:'#7E22CE',tb:'#FDF4FF',name:'Image Compressor',       desc:'Compress JPG/PNG images using your browser canvas.'},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentFilter = 'all';
function renderGrid(tools) {
  const g = document.getElementById('tool-grid');
  if (!tools.length) { g.innerHTML='<p style="color:var(--muted);grid-column:1/-1">No tools found.</p>'; return; }
  g.innerHTML = tools.map((t,i) => `
    <a class="tool-card" onclick="openTool('${t.id}')" href="#" style="animation-delay:${i*28}ms">
      <div class="tool-icon" style="background:${t.color}">${t.icon}</div>
      <div><h3>${t.name}</h3><p>${t.desc}</p></div>
      <span class="tool-tag" style="color:${t.tc};background:${t.tb}">${t.tag}</span>
    </a>`).join('');
}
function filterCategory(cat, btn) {
  currentFilter = cat;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  if (btn) btn.classList.add('active');
  document.getElementById('search-input').value = '';
  renderGrid(cat === 'all' ? TOOLS : TOOLS.filter(t => t.cat === cat));
}
function searchTools(q) {
  q = q.toLowerCase().trim();
  if (!q) { filterCategory(currentFilter); return; }
  renderGrid(TOOLS.filter(t => t.name.toLowerCase().includes(q) || t.desc.toLowerCase().includes(q)));
}
function showHome() { filterCategory('all'); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openTool(id) {
  const t = TOOLS.find(x => x.id === id); if (!t) return;
  document.getElementById('panel-icon').textContent = t.icon;
  document.getElementById('panel-name').textContent = t.name;
  document.getElementById('panel-body').innerHTML = buildUI(id);
  document.getElementById('tool-page').classList.add('open');
  document.body.style.overflow = 'hidden';
  initTool(id);
}
function closeTool() {
  document.getElementById('tool-page').classList.remove('open');
  document.body.style.overflow = '';
}
document.getElementById('tool-page').addEventListener('click', e => {
  if (e.target === document.getElementById('tool-page')) closeTool();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _toastTimer;
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.style.display = 'block';
  clearTimeout(_toastTimer);
  _toastTimer = setTimeout(() => el.style.display = 'none', 2400);
}
function copyText(t) { navigator.clipboard.writeText(t).then(() => toast('âœ“ Copied!')); }
function dlBlob(blob, name) {
  const u = URL.createObjectURL(blob), a = document.createElement('a');
  a.href = u; a.download = name; a.click();
  setTimeout(() => URL.revokeObjectURL(u), 5000);
}
function listFiles(inp, out) {
  const files = Array.from(document.getElementById(inp).files);
  const el = document.getElementById(out); if (!el) return;
  el.innerHTML = files.map(f =>
    `<div class="file-item">ğŸ“„ <span class="fname">${f.name}</span><span class="fsize">${(f.size/1024).toFixed(1)} KB</span></div>`
  ).join('');
}
function setBusy(btnId, label) {
  const b = document.getElementById(btnId); if (!b) return;
  b.innerHTML = `<span class="spinner"></span>${label}`; b.disabled = true;
}
function setIdle(btnId, label) {
  const b = document.getElementById(btnId); if (!b) return;
  b.innerHTML = label; b.disabled = false;
}
function setMsg(id, html) { const el = document.getElementById(id); if (el) el.innerHTML = html; }
function $v(id) { return document.getElementById(id)?.value || ''; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD UIs
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildUI(id) {
  switch (id) {

    /* â”€â”€ PDF MERGE â”€â”€ */
    case 'pdf-merge': return `
      <div class="info-row">ğŸ“ Merging is done locally via pdf-lib. Nothing is uploaded.</div>
      <div class="drop-zone" onclick="document.getElementById('mf').click()">
        <div class="drop-icon">ğŸ“</div><p><span>Click to choose PDF files</span> (2 or more)</p>
      </div>
      <input type="file" class="hidden" id="mf" multiple accept=".pdf" onchange="listFiles('mf','ml')"/>
      <div id="ml" style="margin-top:10px"></div>
      <div class="btn-row">
        <button class="btn btn-primary" id="merge-btn" onclick="mergePDFs()">Merge & Download</button>
      </div>
      <div id="merge-msg"></div>`;

    /* â”€â”€ PDF SPLIT â”€â”€ */
    case 'pdf-split': return `
      <div class="info-row">âœ‚ï¸ Enter page ranges like <strong>1-3, 5, 8</strong>. Processing is 100% local.</div>
      <div class="drop-zone" onclick="document.getElementById('sf').click()">
        <div class="drop-icon">âœ‚ï¸</div><p><span>Click to choose a PDF</span></p>
      </div>
      <input type="file" class="hidden" id="sf" accept=".pdf" onchange="listFiles('sf','sl');getPDFPages('sf','s-info')"/>
      <div id="sl" style="margin-top:10px"></div>
      <div id="s-info" style="font-size:.85rem;color:var(--slate);margin-top:4px"></div>
      <div class="field" style="margin-top:14px">
        <label class="field-label">Page Range (e.g. 1-3, 5, 8)</label>
        <input id="s-range" class="tool-input" placeholder="e.g. 1-3, 5"/>
      </div>
      <div class="btn-row">
        <button class="btn btn-primary" id="split-btn" onclick="splitPDF()">Extract & Download</button>
      </div>
      <div id="split-msg"></div>`;

    /* â”€â”€ PDF INFO â”€â”€ */
    case 'pdf-info': return `
      <div class="info-row">ğŸ“‹ Get page count, size and dimensions instantly.</div>
      <div class="drop-zone" onclick="document.getElementById('pif').click()">
        <div class="drop-icon">ğŸ“„</div><p><span>Click to choose a PDF</span></p>
      </div>
      <input type="file" class="hidden" id="pif" accept=".pdf" onchange="inspectPDF()"/>
      <div id="pi-out" style="margin-top:16px"></div>`;

    /* â”€â”€ IMAGE TO PDF â”€â”€ */
    case 'img-to-pdf': return `
      <div class="info-row">ğŸ–¼ï¸ Images are embedded into a PDF entirely in your browser using pdf-lib.</div>
      <div class="drop-zone" onclick="document.getElementById('iff').click()">
        <div class="drop-icon">ğŸ–¼ï¸</div><p><span>Click to choose images</span> â€” JPG or PNG</p>
      </div>
      <input type="file" class="hidden" id="iff" multiple accept="image/jpeg,image/png" onchange="listFiles('iff','ifl')"/>
      <div id="ifl" style="margin-top:10px"></div>
      <div class="field" style="margin-top:12px">
        <label class="field-label">Page Size</label>
        <select id="i2p-size" class="tool-select">
          <option value="a4">A4</option>
          <option value="letter">US Letter</option>
          <option value="fit">Fit to Image</option>
        </select>
      </div>
      <div class="btn-row">
        <button class="btn btn-primary" id="i2p-btn" onclick="imagesToPDF()">Create PDF & Download</button>
      </div>
      <div id="i2p-msg"></div>`;

    /* â”€â”€ WORD TO PDF â”€â”€ */
    case 'word-to-pdf': return `
      <div class="info-row">ğŸ“ mammoth.js converts your .docx to HTML, which is rendered pixel-accurately into a PDF using html2canvas + jsPDF. Formatting, bold, headings and lists are all preserved.</div>
      <div class="drop-zone" onclick="document.getElementById('w2p-f').click()">
        <div class="drop-icon">ğŸ“</div>
        <p><span>Click to choose a Word file</span> (.docx only)</p>
        <p style="font-size:.8rem;margin-top:6px;color:var(--muted)">Complex formatting may be simplified</p>
      </div>
      <input type="file" class="hidden" id="w2p-f" accept=".docx" onchange="loadWordFile()"/>
      <div id="w2p-file" style="margin-top:10px"></div>
      <div id="w2p-preview-wrap" style="display:none;margin-top:16px">
        <label class="field-label">Document Preview</label>
        <div id="w2p-preview" class="preview-box"></div>
        <div class="btn-row" style="margin-top:14px">
          <button class="btn btn-primary" id="w2p-btn" onclick="wordToPDF()">â¬‡ Download as PDF</button>
          <button class="btn btn-outline" onclick="clearW2P()">Clear</button>
        </div>
      </div>
      <div id="w2p-msg"></div>`;

    /* â”€â”€ PDF TO WORD â”€â”€ */
    case 'pdf-to-word': return `
      <div class="info-row">ğŸ“„ PDF.js extracts text from your PDF page by page, then a real .docx is built using Open XML + JSZip â€” no upload, no server.</div>
      <div class="drop-zone" onclick="document.getElementById('p2w-f').click()">
        <div class="drop-icon">ğŸ“„</div>
        <p><span>Click to choose a PDF file</span></p>
        <p style="font-size:.8rem;margin-top:6px;color:var(--muted)">Works best with text-based PDFs (not scanned images)</p>
      </div>
      <input type="file" class="hidden" id="p2w-f" accept=".pdf" onchange="loadPDFForWord()"/>
      <div id="p2w-file" style="margin-top:10px"></div>
      <div id="p2w-preview-wrap" style="display:none;margin-top:16px">
        <label class="field-label">Extracted Text Preview</label>
        <div id="p2w-preview" class="preview-box preview-box-mono"></div>
        <div id="p2w-stats" style="margin-top:6px;font-size:.82rem;color:var(--muted)"></div>
        <div class="btn-row" style="margin-top:14px">
          <button class="btn btn-primary" id="p2w-btn" onclick="pdfToWord()">â¬‡ Download as .docx</button>
          <button class="btn btn-outline" onclick="clearP2W()">Clear</button>
        </div>
      </div>
      <div id="p2w-msg"></div>`;

    /* â”€â”€ WORD COUNTER â”€â”€ */
    case 'word-counter': return `
      <div class="field">
        <label class="field-label">Your Text</label>
        <textarea id="wc-in" class="tool-textarea" rows="8" placeholder="Start typing or paste textâ€¦" oninput="wordCount()"></textarea>
      </div>
      <div class="stat-grid">
        <div class="stat-card"><div class="num" id="wc-w">0</div><div class="lbl">Words</div></div>
        <div class="stat-card"><div class="num" id="wc-c">0</div><div class="lbl">Characters</div></div>
        <div class="stat-card"><div class="num" id="wc-cn">0</div><div class="lbl">Chars (no spaces)</div></div>
        <div class="stat-card"><div class="num" id="wc-s">0</div><div class="lbl">Sentences</div></div>
        <div class="stat-card"><div class="num" id="wc-p">0</div><div class="lbl">Paragraphs</div></div>
        <div class="stat-card"><div class="num" id="wc-r">0</div><div class="lbl">Read time (min)</div></div>
      </div>
      <div class="btn-row">
        <button class="btn btn-danger" onclick="document.getElementById('wc-in').value='';wordCount()">Clear</button>
      </div>`;

    /* â”€â”€ CASE CONVERTER â”€â”€ */
    case 'case-convert': return `
      <div class="field"><label class="field-label">Input</label>
        <textarea id="cc-in" class="tool-textarea" rows="5" placeholder="Type your text hereâ€¦"></textarea>
      </div>
      <div class="btn-row">
        <button class="btn btn-primary"  onclick="caseConvert('upper')">UPPERCASE</button>
        <button class="btn btn-outline"  onclick="caseConvert('lower')">lowercase</button>
        <button class="btn btn-outline"  onclick="caseConvert('title')">Title Case</button>
        <button class="btn btn-outline"  onclick="caseConvert('sentence')">Sentence case</button>
        <button class="btn btn-outline"  onclick="caseConvert('camel')">camelCase</button>
        <button class="btn btn-outline"  onclick="caseConvert('snake')">snake_case</button>
        <button class="btn btn-outline"  onclick="caseConvert('kebab')">kebab-case</button>
      </div>
      <div class="field" style="margin-top:16px"><label class="field-label">Result</label>
        <textarea id="cc-out" class="tool-textarea" rows="5" readonly></textarea>
      </div>
      <div class="btn-row"><button class="btn btn-success" onclick="copyText($v('cc-out'))">Copy Result</button></div>`;

    /* â”€â”€ LOREM IPSUM â”€â”€ */
    case 'lorem-gen': return `
      <div class="two-col">
        <div class="field"><label class="field-label">Count</label><input id="lg-n" class="tool-input" type="number" min="1" max="50" value="3"/></div>
        <div class="field"><label class="field-label">Type</label>
          <select id="lg-t" class="tool-select">
            <option value="p">Paragraphs</option><option value="s">Sentences</option><option value="w">Words</option>
          </select>
        </div>
      </div>
      <div class="btn-row" style="margin-bottom:16px"><button class="btn btn-primary" onclick="lorem()">Generate</button></div>
      <div class="field"><label class="field-label">Output</label>
        <textarea id="lg-out" class="tool-textarea" rows="9" readonly></textarea>
      </div>
      <div class="btn-row"><button class="btn btn-success" onclick="copyText($v('lg-out'))">Copy</button></div>`;

    /* â”€â”€ TEXT DIFF â”€â”€ */
    case 'text-diff': return `
      <div class="two-col">
        <div class="field"><label class="field-label">Original</label><textarea id="da" class="tool-textarea" rows="8" placeholder="Originalâ€¦"></textarea></div>
        <div class="field"><label class="field-label">Modified</label><textarea id="db" class="tool-textarea" rows="8" placeholder="Modifiedâ€¦"></textarea></div>
      </div>
      <div class="btn-row" style="margin-bottom:16px"><button class="btn btn-primary" onclick="doDiff()">Compare</button></div>
      <div id="diff-out" class="result-box" style="font-family:'DM Sans',sans-serif;line-height:1.8">Differences will appear hereâ€¦</div>`;

    /* â”€â”€ REMOVE LINES â”€â”€ */
    case 'remove-lines': return `
      <div class="field"><label class="field-label">Input</label>
        <textarea id="rl-in" class="tool-textarea" rows="7" placeholder="Paste text with duplicate linesâ€¦"></textarea>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:12px;margin-bottom:16px">
        <label style="display:flex;align-items:center;gap:6px;font-size:.875rem;cursor:pointer"><input type="checkbox" id="rl-d" checked> Remove duplicates</label>
        <label style="display:flex;align-items:center;gap:6px;font-size:.875rem;cursor:pointer"><input type="checkbox" id="rl-e" checked> Remove empty lines</label>
        <label style="display:flex;align-items:center;gap:6px;font-size:.875rem;cursor:pointer"><input type="checkbox" id="rl-t"> Trim whitespace</label>
      </div>
      <div class="btn-row" style="margin-bottom:16px"><button class="btn btn-primary" onclick="removeLines()">Process</button></div>
      <div class="field"><label class="field-label">Result</label>
        <textarea id="rl-out" class="tool-textarea" rows="7" readonly></textarea>
      </div>
      <div class="btn-row"><button class="btn btn-success" onclick="copyText($v('rl-out'))">Copy</button></div>`;

    /* â”€â”€ BASE64 â”€â”€ */
    case 'base64': return `
      <div class="field"><label class="field-label">Input</label>
        <textarea id="b64-in" class="tool-textarea" rows="5" placeholder="Paste text or Base64â€¦"></textarea>
      </div>
      <div class="btn-row" style="margin-bottom:16px">
        <button class="btn btn-primary" onclick="b64('e')">Encode â†’</button>
        <button class="btn btn-outline"  onclick="b64('d')">â† Decode</button>
        <button class="btn btn-danger"   onclick="document.getElementById('b64-in').value='';document.getElementById('b64-out').textContent=''">Clear</button>
      </div>
      <div class="field"><label class="field-label">Output</label><div class="result-box" id="b64-out">Result hereâ€¦</div></div>
      <div class="btn-row"><button class="btn btn-success" onclick="copyText(document.getElementById('b64-out').textContent)">Copy</button></div>`;

    /* â”€â”€ URL ENCODE â”€â”€ */
    case 'url-encode': return `
      <div class="field"><label class="field-label">Input</label>
        <textarea id="ue-in" class="tool-textarea" rows="5" placeholder="Paste URL or encoded stringâ€¦"></textarea>
      </div>
      <div class="btn-row" style="margin-bottom:16px">
        <button class="btn btn-primary" onclick="urlEnc('e')">Encode â†’</button>
        <button class="btn btn-outline"  onclick="urlEnc('d')">â† Decode</button>
      </div>
      <div class="field"><label class="field-label">Output</label><div class="result-box" id="ue-out">Result hereâ€¦</div></div>
      <div class="btn-row"><button class="btn btn-success" onclick="copyText(document.getElementById('ue-out').textContent)">Copy</button></div>`;

    /* â”€â”€ JSON FORMATTER â”€â”€ */
    case 'json-fmt': return `
      <div class="field"><label class="field-label">Paste JSON</label>
        <textarea id="jf-in" class="tool-textarea" rows="7" placeholder='{"name":"AppletTools"}'></textarea>
      </div>
      <div class="btn-row" style="margin-bottom:16px">
        <button class="btn btn-primary" onclick="jsonFmt()">Format & Validate</button>
        <button class="btn btn-outline"  onclick="jsonMin()">Minify</button>
        <button class="btn btn-danger"   onclick="document.getElementById('jf-in').value='';document.getElementById('jf-out').textContent=''">Clear</button>
      </div>
      <div class="field"><label class="field-label">Output</label><div class="result-box" id="jf-out">Formatted JSONâ€¦</div></div>
      <div class="btn-row"><button class="btn btn-success" onclick="copyText(document.getElementById('jf-out').textContent)">Copy</button></div>`;

    /* â”€â”€ CSV TO JSON â”€â”€ */
    case 'csv-to-json': return `
      <div class="field"><label class="field-label">CSV Input</label>
        <textarea id="csv-in" class="tool-textarea" rows="7" placeholder="name,age,city&#10;Alice,30,London&#10;Bob,25,Paris"></textarea>
      </div>
      <div class="field"><label class="field-label">Delimiter</label>
        <select id="csv-d" class="tool-select" style="width:auto">
          <option value=",">Comma (,)</option><option value=";">Semicolon (;)</option><option value="&#9;">Tab</option>
        </select>
      </div>
      <div class="btn-row" style="margin-bottom:16px"><button class="btn btn-primary" onclick="csvToJson()">Convert</button></div>
      <div class="field"><label class="field-label">JSON Output</label><div class="result-box" id="csv-out">JSON will appear hereâ€¦</div></div>
      <div class="btn-row"><button class="btn btn-success" onclick="copyText(document.getElementById('csv-out').textContent)">Copy</button></div>`;

    /* â”€â”€ COLOR PICKER â”€â”€ */
    case 'color-picker': return `
      <div style="text-align:center;padding:10px 0 20px">
        <input type="color" id="cp" value="#2563EB" oninput="updateColor(this.value)"
          style="width:120px;height:120px;border:none;cursor:pointer;border-radius:16px;"/>
        <p style="margin-top:8px;font-size:.85rem;color:var(--muted)">Click to open the color picker</p>
      </div>
      <div class="color-formats" id="cp-out"></div>`;

    /* â”€â”€ PASSWORD GEN â”€â”€ */
    case 'password-gen': return `
      <div class="two-col">
        <div class="field"><label class="field-label">Length</label><input id="pw-l" class="tool-input" type="number" min="4" max="128" value="16"/></div>
        <div class="field"><label class="field-label">Count</label><input id="pw-c" class="tool-input" type="number" min="1" max="20" value="5"/></div>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:16px">
        <label style="display:flex;align-items:center;gap:6px;font-size:.875rem;cursor:pointer"><input type="checkbox" id="pw-U" checked> A-Z</label>
        <label style="display:flex;align-items:center;gap:6px;font-size:.875rem;cursor:pointer"><input type="checkbox" id="pw-u" checked> a-z</label>
        <label style="display:flex;align-items:center;gap:6px;font-size:.875rem;cursor:pointer"><input type="checkbox" id="pw-n" checked> 0-9</label>
        <label style="display:flex;align-items:center;gap:6px;font-size:.875rem;cursor:pointer"><input type="checkbox" id="pw-s" checked> !@#$%</label>
      </div>
      <div class="btn-row" style="margin-bottom:16px"><button class="btn btn-primary" onclick="genPasswords()">Generate</button></div>
      <div class="result-box" id="pw-out" style="line-height:2.2">Passwords will appear hereâ€¦</div>
      <div class="btn-row"><button class="btn btn-success" onclick="copyText(document.getElementById('pw-out').textContent)">Copy All</button></div>`;

    /* â”€â”€ CHAR COUNTER â”€â”€ */
    case 'char-counter': return `
      <div class="field"><label class="field-label">Input Text</label>
        <textarea id="chc-in" class="tool-textarea" rows="7" placeholder="Start typingâ€¦" oninput="charCount()"></textarea>
      </div>
      <div class="stat-grid">
        <div class="stat-card"><div class="num" id="chc-t">0</div><div class="lbl">Total</div></div>
        <div class="stat-card"><div class="num" id="chc-l">0</div><div class="lbl">Letters</div></div>
        <div class="stat-card"><div class="num" id="chc-d">0</div><div class="lbl">Digits</div></div>
        <div class="stat-card"><div class="num" id="chc-sp">0</div><div class="lbl">Spaces</div></div>
        <div class="stat-card"><div class="num" id="chc-x">0</div><div class="lbl">Special</div></div>
        <div class="stat-card"><div class="num" id="chc-ln">0</div><div class="lbl">Lines</div></div>
      </div>`;

    /* â”€â”€ UUID GEN â”€â”€ */
    case 'uuid-gen': return `
      <div class="two-col">
        <div class="field"><label class="field-label">Count</label><input id="uid-n" class="tool-input" type="number" min="1" max="50" value="5"/></div>
        <div class="field"><label class="field-label">Version</label>
          <select id="uid-v" class="tool-select"><option value="4">UUID v4 (Random)</option></select>
        </div>
      </div>
      <div class="btn-row" style="margin-bottom:16px"><button class="btn btn-primary" onclick="genUUIDs()">Generate</button></div>
      <div class="result-box" id="uid-out" style="line-height:2">UUIDs will appear hereâ€¦</div>
      <div class="btn-row"><button class="btn btn-success" onclick="copyText(document.getElementById('uid-out').textContent)">Copy All</button></div>`;

    /* â”€â”€ UNIX TIME â”€â”€ */
    case 'unix-time': return `
      <div class="info-row">ğŸ• Current Unix timestamp: <strong id="cur-ts"></strong></div>
      <div class="two-col">
        <div class="field"><label class="field-label">Timestamp â†’ Date</label>
          <input id="ts-in" class="tool-input" type="number" placeholder="e.g. 1700000000"/>
          <div class="btn-row"><button class="btn btn-primary" onclick="ts2date()">Convert</button></div>
          <div class="result-box" id="ts-out" style="margin-top:10px">Result hereâ€¦</div>
        </div>
        <div class="field"><label class="field-label">Date â†’ Timestamp</label>
          <input id="dt-in" class="tool-input" type="datetime-local"/>
          <div class="btn-row"><button class="btn btn-primary" onclick="date2ts()">Convert</button></div>
          <div class="result-box" id="dt-out" style="margin-top:10px">Result hereâ€¦</div>
        </div>
      </div>`;

    /* â”€â”€ IMAGE COMPRESSOR â”€â”€ */
    case 'img-compress': return `
      <div class="info-row">ğŸ—œï¸ Compression uses the browser Canvas API. Your images never leave your device.</div>
      <div class="drop-zone" onclick="document.getElementById('ic-f').click()">
        <div class="drop-icon">ğŸ—œï¸</div><p><span>Click to choose images</span> â€” JPG or PNG</p>
      </div>
      <input type="file" class="hidden" id="ic-f" multiple accept="image/jpeg,image/png" onchange="listFiles('ic-f','ic-l')"/>
      <div id="ic-l" style="margin-top:10px"></div>
      <div class="field" style="margin-top:12px">
        <label class="field-label">Quality: <span id="ic-ql">80%</span></label>
        <input type="range" id="ic-q" min="10" max="100" value="80" style="width:100%;margin-top:6px" oninput="document.getElementById('ic-ql').textContent=this.value+'%'"/>
      </div>
      <div class="btn-row"><button class="btn btn-primary" id="ic-btn" onclick="compressImages()">Compress & Download</button></div>
      <div id="ic-msg" style="margin-top:12px"></div>`;

    default: return `<p style="color:var(--muted)">Coming soon.</p>`;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT HOOKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initTool(id) {
  if (id === 'unix-time') {
    const tick = () => { const e = document.getElementById('cur-ts'); if (e) e.textContent = Math.floor(Date.now()/1000); };
    tick(); setInterval(tick, 1000);
    const now = new Date();
    document.getElementById('dt-in').value = new Date(now - now.getTimezoneOffset()*60000).toISOString().slice(0,16);
  }
  if (id === 'color-picker') updateColor('#2563EB');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF TOOLS â€” pdf-lib
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function mergePDFs() {
  const inp = document.getElementById('mf');
  if (!inp.files.length || inp.files.length < 2) {
    setMsg('merge-msg','<div class="error-banner">âš ï¸ Please select at least 2 PDF files.</div>'); return;
  }
  setBusy('merge-btn','Mergingâ€¦');
  try {
    const { PDFDocument } = PDFLib;
    const merged = await PDFDocument.create();
    for (const f of Array.from(inp.files)) {
      const src = await PDFDocument.load(await f.arrayBuffer());
      const pages = await merged.copyPages(src, src.getPageIndices());
      pages.forEach(p => merged.addPage(p));
    }
    dlBlob(new Blob([await merged.save()], {type:'application/pdf'}), 'merged.pdf');
    setMsg('merge-msg',`<div class="success-banner">âœ… ${inp.files.length} PDFs merged â€” downloading!</div>`);
  } catch(e) { setMsg('merge-msg',`<div class="error-banner">âš ï¸ ${e.message}</div>`); }
  setIdle('merge-btn','Merge & Download');
}

function parseRange(str, total) {
  const s = new Set();
  str.split(',').forEach(p => {
    p = p.trim();
    if (p.includes('-')) {
      let [a,b] = p.split('-').map(Number);
      for (let i = Math.max(1,a); i <= Math.min(total,b); i++) s.add(i);
    } else { const n = +p; if (n >= 1 && n <= total) s.add(n); }
  });
  return [...s].sort((a,b) => a-b);
}

async function splitPDF() {
  const inp = document.getElementById('sf');
  const range = document.getElementById('s-range').value.trim();
  if (!inp.files.length) { setMsg('split-msg','<div class="error-banner">âš ï¸ Choose a PDF first.</div>'); return; }
  if (!range)            { setMsg('split-msg','<div class="error-banner">âš ï¸ Enter a page range.</div>'); return; }
  setBusy('split-btn','Extractingâ€¦');
  try {
    const { PDFDocument } = PDFLib;
    const src = await PDFDocument.load(await inp.files[0].arrayBuffer());
    const pages = parseRange(range, src.getPageCount());
    if (!pages.length) { setMsg('split-msg','<div class="error-banner">âš ï¸ No valid pages in that range.</div>'); return; }
    const out = await PDFDocument.create();
    const copied = await out.copyPages(src, pages.map(p => p-1));
    copied.forEach(p => out.addPage(p));
    dlBlob(new Blob([await out.save()], {type:'application/pdf'}), 'extracted.pdf');
    setMsg('split-msg',`<div class="success-banner">âœ… Extracted pages: ${pages.join(', ')} â€” downloading!</div>`);
  } catch(e) { setMsg('split-msg',`<div class="error-banner">âš ï¸ ${e.message}</div>`); }
  setIdle('split-btn','Extract & Download');
}

async function getPDFPages(inp, out) {
  const f = document.getElementById(inp).files[0];
  const el = document.getElementById(out); if (!f || !el) return;
  try {
    const { PDFDocument } = PDFLib;
    const doc = await PDFDocument.load(await f.arrayBuffer());
    el.textContent = `This PDF has ${doc.getPageCount()} pages.`;
  } catch(e) { el.textContent = ''; }
}

async function inspectPDF() {
  const inp = document.getElementById('pif');
  if (!inp.files.length) return;
  try {
    const { PDFDocument } = PDFLib;
    const f = inp.files[0];
    const doc = await PDFDocument.load(await f.arrayBuffer());
    const pg = doc.getPageCount();
    const p0 = doc.getPage(0);
    const { width, height } = p0.getSize();
    document.getElementById('pi-out').innerHTML = `
      <div class="stat-grid">
        <div class="stat-card"><div class="num">${pg}</div><div class="lbl">Pages</div></div>
        <div class="stat-card"><div class="num">${(f.size/1024).toFixed(0)}</div><div class="lbl">Size (KB)</div></div>
        <div class="stat-card"><div class="num">${Math.round(width)}</div><div class="lbl">Width (pt)</div></div>
        <div class="stat-card"><div class="num">${Math.round(height)}</div><div class="lbl">Height (pt)</div></div>
      </div>
      <div class="success-banner">âœ… ${f.name} â€” ${pg} page${pg>1?'s':''}, ${(f.size/1024).toFixed(1)} KB</div>`;
  } catch(e) { document.getElementById('pi-out').innerHTML=`<div class="error-banner">âš ï¸ ${e.message}</div>`; }
}

async function imagesToPDF() {
  const inp = document.getElementById('iff');
  const size = document.getElementById('i2p-size').value;
  if (!inp.files.length) { setMsg('i2p-msg','<div class="error-banner">âš ï¸ Choose at least one image.</div>'); return; }
  setBusy('i2p-btn','Creating PDFâ€¦');
  try {
    const { PDFDocument } = PDFLib;
    const doc = await PDFDocument.create();
    for (const f of Array.from(inp.files)) {
      const buf = await f.arrayBuffer();
      const img = f.type === 'image/jpeg' ? await doc.embedJpg(buf) : await doc.embedPng(buf);
      let pw, ph;
      if (size === 'a4')     { pw=595; ph=842; }
      else if (size==='letter') { pw=612; ph=792; }
      else                   { pw=img.width; ph=img.height; }
      const page = doc.addPage([pw, ph]);
      const scale = Math.min(pw/img.width, ph/img.height);
      const w = img.width*scale, h = img.height*scale;
      page.drawImage(img, {x:(pw-w)/2, y:(ph-h)/2, width:w, height:h});
    }
    dlBlob(new Blob([await doc.save()], {type:'application/pdf'}), 'images.pdf');
    setMsg('i2p-msg',`<div class="success-banner">âœ… PDF with ${inp.files.length} image(s) â€” downloading!</div>`);
  } catch(e) { setMsg('i2p-msg',`<div class="error-banner">âš ï¸ ${e.message}</div>`); }
  setIdle('i2p-btn','Create PDF & Download');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORD TO PDF â€” mammoth.js converts .docx to HTML,
   html2canvas renders it, jsPDF packages into PDF
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _w2pHTML = '';

async function loadWordFile() {
  const inp = document.getElementById('w2p-f');
  _w2pHTML = '';
  if (!inp.files.length) return;
  const f = inp.files[0];
  document.getElementById('w2p-file').innerHTML =
    `<div class="file-item">ğŸ“ <span class="fname">${f.name}</span><span class="fsize">${(f.size/1024).toFixed(1)} KB</span></div>`;
  setMsg('w2p-msg','');
  try {
    const buf = await f.arrayBuffer();
    const result = await mammoth.convertToHtml({arrayBuffer: buf});
    _w2pHTML = result.value;
    document.getElementById('w2p-preview').innerHTML = _w2pHTML || '<p style="color:var(--muted)">(Empty document)</p>';
    document.getElementById('w2p-preview-wrap').style.display = 'block';
    if (result.messages.length) {
      setMsg('w2p-msg',`<div class="info-row">â„¹ï¸ ${result.messages.length} formatting note(s) â€” content preserved, minor styling may differ.</div>`);
    }
  } catch(e) {
    setMsg('w2p-msg',`<div class="error-banner">âš ï¸ Could not read file: ${e.message}</div>`);
  }
}

async function wordToPDF() {
  if (!_w2pHTML) { setMsg('w2p-msg','<div class="error-banner">âš ï¸ Load a Word file first.</div>'); return; }
  const fname = document.getElementById('w2p-f').files[0]?.name.replace(/\.docx$/i,'') || 'document';
  setBusy('w2p-btn','Rendering PDFâ€¦');
  setMsg('w2p-msg','');

  try {
    // Create a hidden off-screen container styled like an A4 page
    const container = document.createElement('div');
    container.style.cssText = `
      position:fixed; left:-9999px; top:0;
      width:794px; padding:60px 72px;
      background:white; color:#111;
      font-family:Calibri,Arial,sans-serif; font-size:11pt; line-height:1.6;
      box-sizing:border-box;
    `;
    // Inject styling that mirrors Word's default styles
    container.innerHTML = `
      <style>
        * { box-sizing:border-box; }
        h1 { font-size:20pt; font-weight:700; margin:0 0 10px; color:#1a1a2e; border-bottom:2px solid #e0e0e0; padding-bottom:6px; }
        h2 { font-size:16pt; font-weight:700; margin:18px 0 8px; color:#2d2d2d; }
        h3 { font-size:13pt; font-weight:700; margin:14px 0 6px; color:#2d2d2d; }
        h4,h5,h6 { font-size:11pt; font-weight:700; margin:12px 0 4px; }
        p  { margin:0 0 8px; }
        ul,ol { margin:0 0 10px; padding-left:24px; }
        li { margin-bottom:3px; }
        strong,b { font-weight:700; }
        em,i { font-style:italic; }
        table { border-collapse:collapse; width:100%; margin-bottom:12px; }
        td,th { border:1px solid #ccc; padding:5px 8px; font-size:10pt; }
        th { background:#f0f0f0; font-weight:700; }
        a  { color:#2563EB; }
      </style>
      ${_w2pHTML}`;
    document.body.appendChild(container);

    // Give browser time to render fonts/layout
    await new Promise(r => setTimeout(r, 300));

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ unit:'px', format:'a4', orientation:'portrait' });
    const pdfW = pdf.internal.pageSize.getWidth();
    const pdfH = pdf.internal.pageSize.getHeight();
    const pageH = pdfH - 60; // leave 30px margins top+bottom

    // Split content into A4-height chunks
    const totalH = container.scrollHeight;
    let yOffset = 0;
    let pageIndex = 0;

    while (yOffset < totalH) {
      const canvas = await html2canvas(container, {
        scale: 2,
        useCORS: true,
        allowTaint: true,
        y: yOffset,
        height: Math.min(pageH / (pdfW / container.offsetWidth), totalH - yOffset),
        width: container.offsetWidth,
        windowWidth: container.offsetWidth,
        backgroundColor: '#ffffff',
        logging: false,
      });

      const imgData = canvas.toDataURL('image/jpeg', 0.92);
      const imgH = canvas.height / (canvas.width / pdfW);

      if (pageIndex > 0) pdf.addPage();
      pdf.addImage(imgData, 'JPEG', 0, 30, pdfW, Math.min(imgH, pageH));

      yOffset += pageH / (pdfW / container.offsetWidth);
      pageIndex++;
    }

    document.body.removeChild(container);
    pdf.save(fname + '.pdf');
    setMsg('w2p-msg',`<div class="success-banner">âœ… <strong>${fname}.pdf</strong> is downloading!</div>`);

  } catch(e) {
    setMsg('w2p-msg',`<div class="error-banner">âš ï¸ ${e.message}</div>`);
    console.error(e);
    // Clean up container if it exists
    const c = document.querySelector('div[style*="-9999px"]');
    if (c) document.body.removeChild(c);
  }
  setIdle('w2p-btn','â¬‡ Download as PDF');
}

function clearW2P() {
  document.getElementById('w2p-f').value='';
  document.getElementById('w2p-file').innerHTML='';
  document.getElementById('w2p-preview-wrap').style.display='none';
  setMsg('w2p-msg','');
  _w2pHTML='';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF TO WORD â€” PDF.js (text extraction) + docx.js
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _p2wPages = [];

async function loadPDFForWord() {
  const inp = document.getElementById('p2w-f');
  _p2wPages = [];
  if (!inp.files.length) return;
  const f = inp.files[0];
  document.getElementById('p2w-file').innerHTML =
    `<div class="file-item">ğŸ“„ <span class="fname">${f.name}</span><span class="fsize">${(f.size/1024).toFixed(1)} KB</span></div>`;
  setMsg('p2w-msg','<div class="info-row"><span class="spinner spinner-blue"></span> Extracting textâ€¦</div>');
  document.getElementById('p2w-preview-wrap').style.display = 'none';

  try {
    const buf  = await f.arrayBuffer();
    const pdf  = await pdfjsLib.getDocument({data: buf}).promise;
    const total = pdf.numPages;
    let fullText = '';

    for (let i = 1; i <= total; i++) {
      const pg   = await pdf.getPage(i);
      const tc   = await pg.getTextContent();
      // Build lines: group items by their Y position (rounded to nearest 3pt)
      const byY = {};
      for (const item of tc.items) {
        if (!item.str) continue;
        const y = Math.round(item.transform[5] / 3) * 3;
        if (!byY[y]) byY[y] = [];
        byY[y].push(item.str);
      }
      // Sort Y descending (top of page first) and join each line
      const lines = Object.keys(byY)
        .map(Number).sort((a,b) => b-a)
        .map(y => byY[y].join(' ').trim())
        .filter(l => l.length > 0);

      _p2wPages.push({pageNum: i, lines});
      fullText += `--- Page ${i} ---\n${lines.join('\n')}\n\n`;
    }

    const wc = fullText.trim().split(/\s+/).filter(Boolean).length;
    document.getElementById('p2w-preview').textContent = fullText || '(No text extracted)';
    document.getElementById('p2w-stats').textContent   = `${total} page(s) Â· ~${wc.toLocaleString()} words extracted`;
    document.getElementById('p2w-preview-wrap').style.display = 'block';
    setMsg('p2w-msg', fullText.trim() ? '' :
      '<div class="info-row">â„¹ï¸ No text found â€” this PDF may be scanned or image-based. OCR is required for those.</div>');

  } catch(e) {
    setMsg('p2w-msg',`<div class="error-banner">âš ï¸ Could not read PDF: ${e.message}</div>`);
  }
}

async function pdfToWord() {
  const fname = document.getElementById('p2w-f').files[0]?.name.replace(/\.pdf$/i,'') || 'document';
  if (!_p2wPages.length) { setMsg('p2w-msg','<div class="error-banner">âš ï¸ Load a PDF first.</div>'); return; }
  setBusy('p2w-btn','Building .docxâ€¦');
  setMsg('p2w-msg','');

  try {
    // Build a real .docx from scratch using Open XML (ZIP of XML files)
    // No external docx library needed â€” just JSZip + raw XML strings

    const xmlEsc = s => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');

    // Build the document body XML
    let bodyXml = '';

    // Title paragraph
    bodyXml += `
      <w:p>
        <w:pPr><w:pStyle w:val="Heading1"/><w:spacing w:after="120"/></w:pPr>
        <w:r><w:rPr><w:b/><w:color w:val="0F172A"/><w:sz w:val="36"/></w:rPr>
          <w:t>${xmlEsc(fname)}</w:t></w:r>
      </w:p>
      <w:p>
        <w:pPr><w:spacing w:after="400"/></w:pPr>
        <w:r><w:rPr><w:i/><w:color w:val="94A3B8"/><w:sz w:val="18"/></w:rPr>
          <w:t>Converted from PDF by AppletTools Â· ${xmlEsc(new Date().toLocaleDateString())}</w:t></w:r>
      </w:p>`;

    for (const pg of _p2wPages) {
      // Page heading
      bodyXml += `
        <w:p>
          <w:pPr><w:spacing w:before="320" w:after="120"/>
            <w:pBdr><w:bottom w:val="single" w:sz="4" w:space="1" w:color="BFDBFE"/></w:pBdr>
          </w:pPr>
          <w:r><w:rPr><w:b/><w:color w:val="2563EB"/><w:sz w:val="22"/></w:rPr>
            <w:t>Page ${pg.pageNum}</w:t></w:r>
        </w:p>`;

      if (!pg.lines.length) {
        bodyXml += `
          <w:p><w:pPr><w:spacing w:after="160"/></w:pPr>
            <w:r><w:rPr><w:i/><w:color w:val="94A3B8"/><w:sz w:val="20"/></w:rPr>
              <w:t>(No text extracted from this page)</w:t></w:r>
          </w:p>`;
      } else {
        for (const line of pg.lines) {
          if (!line.trim()) continue;
          const isH = line.length < 80 && /^[A-Z0-9]/.test(line) && !line.endsWith('.');
          bodyXml += `
            <w:p>
              <w:pPr><w:spacing w:after="${isH ? 160 : 100}"/></w:pPr>
              <w:r><w:rPr>
                ${isH ? '<w:b/>' : ''}
                <w:color w:val="${isH ? '1E40AF' : '0F172A'}"/>
                <w:sz w:val="${isH ? 24 : 22}"/>
                <w:szCs w:val="${isH ? 24 : 22}"/>
              </w:rPr>
                <w:t xml:space="preserve">${xmlEsc(line)}</w:t></w:r>
            </w:p>`;
        }
      }

      // Page break between pages (except last)
      if (pg.pageNum < _p2wPages.length) {
        bodyXml += `
          <w:p><w:r><w:br w:type="page"/></w:r></w:p>`;
      }
    }

    // Full document.xml
    const documentXml = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:document xmlns:wpc="http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas"
  xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main"
  xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"
  xmlns:w14="http://schemas.microsoft.com/office/word/2010/wordml">
  <w:body>
    ${bodyXml}
    <w:sectPr>
      <w:pgSz w:w="12240" w:h="15840"/>
      <w:pgMar w:top="1440" w:right="1440" w:bottom="1440" w:left="1440"/>
    </w:sectPr>
  </w:body>
</w:document>`;

    const relsXml = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>
</Relationships>`;

    const wordRelsXml = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/>
</Relationships>`;

    const stylesXml = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:styles xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
  <w:style w:type="paragraph" w:styleId="Normal">
    <w:name w:val="Normal"/>
    <w:rPr><w:sz w:val="22"/><w:szCs w:val="22"/></w:rPr>
  </w:style>
  <w:style w:type="paragraph" w:styleId="Heading1">
    <w:name w:val="heading 1"/>
    <w:basedOn w:val="Normal"/>
    <w:rPr><w:b/><w:sz w:val="32"/><w:szCs w:val="32"/><w:color w:val="1E40AF"/></w:rPr>
  </w:style>
</w:styles>`;

    const contentTypesXml = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
  <Default Extension="xml"  ContentType="application/xml"/>
  <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>
  <Override PartName="/word/styles.xml"   ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml"/>
</Types>`;

    // Pack everything into a ZIP = .docx
    const zip = new JSZip();
    zip.file('[Content_Types].xml', contentTypesXml);
    zip.file('_rels/.rels', relsXml);
    zip.file('word/document.xml', documentXml);
    zip.file('word/styles.xml', stylesXml);
    zip.file('word/_rels/document.xml.rels', wordRelsXml);

    const blob = await zip.generateAsync({
      type:'blob',
      mimeType:'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
      compression:'DEFLATE'
    });

    dlBlob(blob, fname + '.docx');
    setMsg('p2w-msg',`<div class="success-banner">âœ… <strong>${fname}.docx</strong> is downloading!</div>`);

  } catch(e) {
    setMsg('p2w-msg',`<div class="error-banner">âš ï¸ Failed to build .docx: ${e.message}</div>`);
    console.error(e);
  }
  setIdle('p2w-btn','â¬‡ Download as .docx');
}

function clearP2W() {
  document.getElementById('p2w-f').value='';
  document.getElementById('p2w-file').innerHTML='';
  document.getElementById('p2w-preview-wrap').style.display='none';
  setMsg('p2w-msg',''); _p2wPages=[];
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMAGE COMPRESSOR â€” Canvas API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function compressImages() {
  const inp = document.getElementById('ic-f');
  const quality = +document.getElementById('ic-q').value / 100;
  const files = Array.from(inp.files);
  if (!files.length) { setMsg('ic-msg','<div class="error-banner">âš ï¸ Choose images first.</div>'); return; }
  setBusy('ic-btn','Compressingâ€¦');
  setMsg('ic-msg','<div class="info-row"><span class="spinner spinner-blue"></span> Processingâ€¦</div>');
  let html = '';
  for (const f of files) {
    const src = await new Promise(r => { const rd=new FileReader(); rd.onload=e=>r(e.target.result); rd.readAsDataURL(f); });
    const out = await new Promise(r => {
      const img = new Image(); img.onload = () => {
        const c = document.createElement('canvas'); c.width=img.width; c.height=img.height;
        c.getContext('2d').drawImage(img,0,0);
        r(c.toDataURL(f.type==='image/png'?'image/png':'image/jpeg', quality));
      }; img.src = src;
    });
    const a = document.createElement('a'); a.href=out; a.download='compressed_'+f.name; a.click();
    const origKB=(f.size/1024).toFixed(1), newKB=(out.length*0.75/1024).toFixed(1);
    html += `<div class="file-item">âœ… <span class="fname">${f.name}</span><span class="fsize">${origKB} KB â†’ ${newKB} KB</span></div>`;
  }
  setMsg('ic-msg',`<div class="success-banner">âœ… ${files.length} image(s) compressed!</div>`+html);
  setIdle('ic-btn','Compress & Download');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEXT TOOLS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function S(id,v){const e=document.getElementById(id);if(e)e.textContent=v;}
function wordCount(){
  const t=document.getElementById('wc-in').value;
  S('wc-w',t.trim()?t.trim().split(/\s+/).length:0);
  S('wc-c',t.length); S('wc-cn',t.replace(/\s/g,'').length);
  S('wc-s',t.trim()?(t.match(/[.!?]+/g)||[]).length||1:0);
  S('wc-p',t.trim()?t.trim().split(/\n\s*\n/).length:0);
  S('wc-r',Math.max(1,Math.ceil((t.trim()?t.trim().split(/\s+/).length:0)/200)));
}
function caseConvert(type){
  const i=document.getElementById('cc-in').value;
  const m={
    upper:()=>i.toUpperCase(), lower:()=>i.toLowerCase(),
    title:()=>i.replace(/\w\S*/g,w=>w[0].toUpperCase()+w.slice(1).toLowerCase()),
    sentence:()=>i.toLowerCase().replace(/(^\s*\w|[.!?]\s+\w)/g,c=>c.toUpperCase()),
    camel:()=>i.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(_,c)=>c.toUpperCase()),
    snake:()=>i.trim().toLowerCase().replace(/[\s\W]+/g,'_'),
    kebab:()=>i.trim().toLowerCase().replace(/[\s\W]+/g,'-'),
  };
  document.getElementById('cc-out').value=(m[type]||m.lower)();
}
const LW='lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua ut enim ad minim veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur excepteur sint occaecat cupidatat non proident sunt in culpa qui officia deserunt mollit anim id est laborum'.split(' ');
const lw=n=>Array.from({length:n},()=>LW[Math.random()*LW.length|0]).join(' ');
const ls=()=>{const w=lw(Math.floor(Math.random()*12)+5);return w[0].toUpperCase()+w.slice(1)+'.';};
const lp=()=>Array.from({length:Math.floor(Math.random()*4)+3},ls).join(' ');
function lorem(){
  const n=+document.getElementById('lg-n').value||3, t=document.getElementById('lg-t').value;
  document.getElementById('lg-out').value=t==='p'?Array.from({length:n},lp).join('\n\n'):t==='s'?Array.from({length:n},ls).join(' '):lw(n);
}
function doDiff(){
  const a=document.getElementById('da').value.split('\n'), b=document.getElementById('db').value.split('\n');
  let html='',diffs=0;
  for(let i=0;i<Math.max(a.length,b.length);i++){
    const la=a[i]??'',lb=b[i]??'';
    if(la===lb) html+=`<div style="padding:2px 8px">${esc(la)||'&nbsp;'}</div>`;
    else{diffs++;
      if(la)html+=`<div style="background:#FEE2E2;padding:2px 8px;border-radius:4px;color:#991B1B">âˆ’ ${esc(la)}</div>`;
      if(lb)html+=`<div style="background:#DCFCE7;padding:2px 8px;border-radius:4px;color:#166534">+ ${esc(lb)}</div>`;
    }
  }
  document.getElementById('diff-out').innerHTML=diffs?html:'<span style="color:var(--green)">âœ“ Texts are identical.</span>';
}
const esc=s=>s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
function removeLines(){
  let lines=document.getElementById('rl-in').value.split('\n');
  if(document.getElementById('rl-t').checked) lines=lines.map(l=>l.trim());
  if(document.getElementById('rl-e').checked) lines=lines.filter(l=>l.trim());
  if(document.getElementById('rl-d').checked){const s=new Set();lines=lines.filter(l=>s.has(l)?false:!!s.add(l));}
  document.getElementById('rl-out').value=lines.join('\n');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONVERTERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function b64(m){
  try{document.getElementById('b64-out').textContent=
    m==='e'?btoa(unescape(encodeURIComponent(document.getElementById('b64-in').value))):
    decodeURIComponent(escape(atob(document.getElementById('b64-in').value)));}
  catch(e){document.getElementById('b64-out').textContent='âš  '+e.message;}
}
function urlEnc(m){
  try{document.getElementById('ue-out').textContent=
    m==='e'?encodeURIComponent(document.getElementById('ue-in').value):
    decodeURIComponent(document.getElementById('ue-in').value);}
  catch(e){document.getElementById('ue-out').textContent='âš  '+e.message;}
}
function jsonFmt(){
  try{document.getElementById('jf-out').textContent=JSON.stringify(JSON.parse(document.getElementById('jf-in').value),null,2);}
  catch(e){document.getElementById('jf-out').textContent='âš  '+e.message;}
}
function jsonMin(){
  try{document.getElementById('jf-out').textContent=JSON.stringify(JSON.parse(document.getElementById('jf-in').value));}
  catch(e){document.getElementById('jf-out').textContent='âš  '+e.message;}
}
function csvToJson(){
  const raw=document.getElementById('csv-in').value.trim(),d=document.getElementById('csv-d').value;
  if(!raw){document.getElementById('csv-out').textContent='âš  Paste CSV first';return;}
  const rows=raw.split('\n').map(r=>r.split(d).map(c=>c.trim())),hd=rows[0];
  document.getElementById('csv-out').textContent=JSON.stringify(
    rows.slice(1).filter(r=>r.some(c=>c)).map(row=>{const o={};hd.forEach((h,i)=>o[h]=row[i]??'');return o;}),null,2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateColor(hex){
  const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
  const [h,s,l]=rgbToHsl(r,g,b);
  const el=document.getElementById('cp-out');if(!el)return;
  el.innerHTML=[['HEX',hex.toUpperCase()],['RGB',`rgb(${r}, ${g}, ${b})`],['HSL',`hsl(${h}, ${s}%, ${l}%)`],['R',r],['G',g],['B',b]]
    .map(([label,val])=>`<div class="color-format" style="border-top:3px solid ${hex}">
      <div class="fmt-label">${label}</div>
      <div class="fmt-value">${val}<button class="copy-btn" onclick="copyText('${val}')">copy</button></div>
    </div>`).join('');
}
function rgbToHsl(r,g,b){
  r/=255;g/=255;b/=255;const max=Math.max(r,g,b),min=Math.min(r,g,b);
  let h,s,l=(max+min)/2;
  if(max===min){h=s=0;}else{
    const d=max-min;s=l>.5?d/(2-max-min):d/(max+min);
    switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;default:h=(r-g)/d+4;}
    h=Math.round(h*60);s=Math.round(s*100);l=Math.round(l*100);
  }
  return[h,s,l];
}
function genPasswords(){
  const len=+document.getElementById('pw-l').value||16,cnt=+document.getElementById('pw-c').value||5;
  let ch='';
  if(document.getElementById('pw-U').checked)ch+='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  if(document.getElementById('pw-u').checked)ch+='abcdefghijklmnopqrstuvwxyz';
  if(document.getElementById('pw-n').checked)ch+='0123456789';
  if(document.getElementById('pw-s').checked)ch+='!@#$%^&*()_+-=[]{}|;:,.<>?';
  if(!ch){toast('Select at least one character type!');return;}
  document.getElementById('pw-out').textContent=
    Array.from({length:cnt},()=>Array.from({length:len},()=>ch[Math.random()*ch.length|0]).join('')).join('\n');
}
function charCount(){
  const t=document.getElementById('chc-in').value;
  S('chc-t',t.length);S('chc-l',(t.match(/[a-zA-Z]/g)||[]).length);
  S('chc-d',(t.match(/\d/g)||[]).length);S('chc-sp',(t.match(/ /g)||[]).length);
  S('chc-x',(t.match(/[^a-zA-Z0-9\s]/g)||[]).length);S('chc-ln',t?t.split('\n').length:0);
}
function genUUIDs(){
  const n=+document.getElementById('uid-n').value||5;
  document.getElementById('uid-out').textContent=
    Array.from({length:n},()=>'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{const r=Math.random()*16|0;return(c==='x'?r:r&3|8).toString(16);})).join('\n');
}
function ts2date(){
  const ts=+document.getElementById('ts-in').value;
  if(isNaN(ts)){S('ts-out','âš  Invalid');return;}
  const d=new Date(ts*1000);
  document.getElementById('ts-out').textContent=`UTC:   ${d.toUTCString()}\nLocal: ${d.toLocaleString()}\nISO:   ${d.toISOString()}`;
}
function date2ts(){
  const v=document.getElementById('dt-in').value;
  if(!v){S('dt-out','âš  Pick a date');return;}
  document.getElementById('dt-out').textContent=`Unix: ${Math.floor(new Date(v).getTime()/1000)}`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
renderGrid(TOOLS);
</script>
</body>
</html>